<div ng-app="myApp" ng-controller="myCtrl">
    <h1>Manage your files!</h1>

    <div style="border:solid grey 1px; margin:25px, 0; margin-bottom:25px; padding:15px;">
        <h3>View Your Files</h3>
        <select ng-model='selectedFile' ng-options='file.Name for file in files'></select>
        <div>
            <h3>
              <a target="_self" href="http://localhost:27516/files/{{selectedFile.Name | encodeURIComponent}}" download="{{selectedFile.name}}">Download Selected File</a>
            </h3>
        </div>
    </div>
    
    <div  style="border:solid grey 1px; margin:25px, 0; padding:15px;">
        <h3>Upload A New File</h3>
        <input type="file" id="file" name="file" />
        <br>
        <button ng-click="addFile()">Upload File</button>
    </div>

    <script>
        var myApp = angular.module('myApp', []);

        myApp.filter('encodeURIComponent', function () {
            return window.encodeURIComponent;
        });

    myApp.controller('myCtrl', function ($scope, $http) {

        $http.get("http://www.w3schools.com/angular/customers.php")
                .then(function (response) {
                    $scope.files = response.data.records;
                });

        uploadUrl = "http://localhost:27516/files/post?name="
        $scope.data = 'none';

        //upload a file
        $scope.addFile = function () {
            var f = document.getElementById('file').files[0],
                    r = new FileReader();
            r.onloadend = function (e) {
                $scope.data = e.target.result;
            }
            uploadUrl += encodeURIComponent(document.getElementById('file').files[0].name);
            console.log(uploadUrl);
            r.readAsBinaryString(f);

            $http.post(uploadUrl, r, {
                transformRequest: angular.identity,
                headers: {'Content-Type': undefined}
            })

                    .success(function(){
                        alert('success');
                    })

                    .error(function(){
                        alert('error');
                    });
        }
      })
    </script>
</div>
